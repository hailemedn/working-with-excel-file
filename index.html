<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Excel File Upload</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.4/xlsx.full.min.js"></script>
  </head>
  <body>
    <h1>Upload Excel File</h1>
    <input type="file" id="fileInput" accept=".xlsx, .xls" />
    <div>
      <label for="">Comparison for:</label>
      <select name="" id="">
        <option value="Data for Total_Data_Volume_Upda">Total_Data_Volume_Upda</option>
        <option value="Data for 4G data volume">Overall data volume</option>
      </select>
    </div>

    <div id="output"></div>

    <div id="lastday-output"></div>

    <div id="lastweek-output"></div>

    <div id="pipd-from-lastday"></div>

    <div id="pidpd-from-lastweek"></div>

    <script>
      const piPdCalculator = (newValue, oldValue) => {
        const percentage = ((newValue - oldValue) / oldValue) * 100;
        const roundedPercentage = percentage.toFixed(2);
        if (newValue > oldValue) {
          return `Percentage Increase: ${roundedPercentage}%`;
        } else if (newValue < oldValue) {
          return `Percentage Decrease: ${-roundedPercentage}%`;
        } else {
          return "No percentage increase or decrease";
        }
      };

      document
        .getElementById("fileInput")
        .addEventListener("change", function (event) {
          const file = event.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
              const data = new Uint8Array(e.target.result);
              const workbook = XLSX.read(data, { type: "array" });
              const sheetName = "Data for Total_Data_Volume_Upda";
              const worksheet = workbook.Sheets[sheetName];
              const jsonData = XLSX.utils.sheet_to_json(worksheet);
              const lastEntryIndex = jsonData.length - 1;
              const lastDayEntryIndex = jsonData.length - 97;
              const lastWeekEntryIndex = jsonData.length - 671;
              console.log(lastWeekEntryIndex);

              if (jsonData.length > 0) {
                const lastWeekEntry = jsonData[lastWeekEntryIndex];
                const lastDayEntry = jsonData[lastDayEntryIndex];
                const lastEntry = jsonData[lastEntryIndex];
                console.log(lastDayEntry)
                console.log(lastEntry);
                console.log(lastWeekEntry);
                displayLastEntry(lastWeekEntry, lastDayEntry, lastEntry);
              } else {
                document.getElementById("output").innerText =
                  "No data found in the file.";
              }
            };
            reader.readAsArrayBuffer(file);
          }
        });

      function displayLastEntry(lastWeekEntry, lastdayEntry, entry) {
        // const outputDiv = document.getElementById("output");
        // outputDiv.innerHTML = "<h2>Current Entry</h2>";
        // const ul = document.createElement("ul");
        // for (const key in entry) {
        //   if (entry.hasOwnProperty(key)) {
        //     const li = document.createElement("li");
        //     li.textContent = `${key}: ${entry[key]}`;
        //     ul.appendChild(li);
        //   }
        // }
        // outputDiv.appendChild(ul);

        // const lastDayOutputDiv = document.getElementById('lastday-output');
        // lastDayOutputDiv.innerHTML = '<h2>Last Day Entry</h2>';
        // const p = document.createElement('p');
        // for (const key in lastdayEntry) {
        //     if (lastdayEntry.hasOwnProperty(key)) {
        //         p.textContent = `${key}: ${lastdayEntry[key]}`
        //     }
        // }
        // lastDayOutputDiv.appendChild(p);

        const currentOutputDiv = document.getElementById('output');
        currentOutputDiv.innerHTML = `<p>Current value: ${entry['Total_Data_Volume_Updated']}</p>`;

        const lastDayOutputDiv = document.getElementById('lastday-output');
        lastDayOutputDiv.innerHTML = `<p>Last day Entry: ${lastdayEntry['Total_Data_Volume_Updated']}</p>`;


        const lastWeekOutputDiv = document.getElementById('lastweek-output');
        lastWeekOutputDiv.innerHTML = `<p>Last Week Entry: ${lastWeekEntry['Total_Data_Volume_Updated']}</p>`;
        
        
        const lastdayComparison = piPdCalculator(entry['Total_Data_Volume_Updated'], lastdayEntry['Total_Data_Volume_Updated']);
        const lastWeekComparison = piPdCalculator(entry['Total_Data_Volume_Updated'], lastWeekEntry['Total_Data_Volume_Updated'])

        document.getElementById('pipd-from-lastday').innerHTML = `<h4>From yesterday, ${lastdayComparison}</h4>`;
        
        document.getElementById('pidpd-from-lastweek').innerHTML = `<h4>From last week, ${lastWeekComparison}</h4>`;
      }


    </script>
  </body>
</html>
